/**
 * Angular-based model library for use in MVC framework design
 * @version v0.0.2-dev-2015-08-03
 * @link https://github.com/dlhdesign/angular-m
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="angular-m"),function(a,b,c){"use strict";function d(a){return w(arguments,function(b){b!==a&&w(b,function(b,c){a.hasOwnProperty(c)||(a[c]=b)})}),a}function e(a){if(Object.keys)return Object.keys(a);var b=[];return w(a,function(a,c){b.push(c)}),b}function f(a,b){if(Array.prototype.indexOf)return a.indexOf(b,Number(arguments[2])||0);var c=a.length>>>0,d=Number(arguments[2])||0;for(d=0>d?Math.ceil(d):Math.floor(d),0>d&&(d+=c);c>d;d++)if(d in a&&a[d]===b)return d;return-1}function g(a){var b={},c=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));return w(c,function(c){c in a&&(b[c]=a[c])}),b}function h(a,b){var c=r(a),d=c?[]:{};return w(a,function(a,e){b(a,e)&&(d[c?d.length:e]=a)}),d}function i(a,b){function c(a,c,d){return a=a||{},a.method=a.method||h.read,b(a).success(function(a){n(c)&&c(a)}).error(function(a){n(d)&&d(a)})}function d(a,b,d){return a=a||{},a.method=h.read,c(a,b,d)}function e(a,b,d){return a=a||{},a.method=h.update,c(a,b,d)}function f(a,b,d){return a=a||{},a.method=h.create,c(a,b,d)}function g(a,b,d){return a=a||{},a.method=h["delete"],c(a,b,d)}var h={read:"GET",update:"PUT",create:"POST","delete":"DELETE"};return{METHODS:h,call:c,read:d,update:e,create:f,"delete":g,readList:d,updateList:e,createList:f,deleteList:g}}function j(){return{email:/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,latLong:/^[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?),\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/,zip:/^\d{5}(?:[-\s]\d{4})?$/,timeZone:/^GMT\s[+-]\d{2}:\d{2}$/,timeStr:/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,number:/^[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?$/,object:/^{.*}$/,array:/^\[.*]$/,"boolean":/^true|false$/}}function k(){function a(){var a,b,c=this;if(c.isFinal())for(a=x(c.__cbQueue),c.__cbQueue=[];b=a.shift();)(b.type<3&&c.__resolved===!0||b.type>1&&c.__rejected===!0)&&b.cb.call(c)}function b(){}var c=!1,d=/xyz/.test(function(){})?/\b_super\b/:/.*/;return b.prototype={$type:"Base",init:function(a,b){var c=this;return c.__arguments=x(arguments),c.__cbQueue=[],c.__listeners={},c.$errors={},c.$valid=!0,c},clone:function(){var a=this,b=new a.constructor(null,!0);return b.__arguments=x(a.__arguments),b.__resolved=a.__resolved,b.__rejected=a.__rejected,a.trigger("cloned",b),b},isFinal:function(){var a=this;return!(!a.__resolved&&!a.__rejected)},resolve:function(){var b=this;return b.isFinal()||(b.__resolved=!0,a.call(b),b.trigger("resolved"),b.trigger("finalized")),b},reject:function(){var b=this;return b.isFinal()||(b.__rejected=!0,a.call(b),b.trigger("rejected"),b.trigger("finalized")),b},unfinalize:function(){var a=this;return delete a.__resolved,delete a.__rejected,a.trigger("unfinalized"),a},then:function(b,c){var d=this;return n(b)&&d.__cbQueue.push({type:1,cb:b}),n(c)&&d.__cbQueue.push({type:3,cb:c}),d.isFinal()&&a.call(d),d},always:function(b){var c=this;return n(b)&&c.__cbQueue.push({type:2,cb:b}),c.isFinal()&&a.call(c),c},success:function(a){return this.then(a)},fail:function(a){return this.then(null,a)},bind:function(a,b){var c=this;return o(a)&&n(b)&&(c.__listeners[a]=c.__listeners[a]||[],c.__listeners[a].push(b)),c},unbind:function(a,b){var c=this;return o(a)&&r(c.__listeners[a])&&c.__listeners[a].length>0&&(n(b)?c.__listeners[a]=h(c.__listeners[a],function(a){return a!==b}):delete c.__listeners[a]),c},one:function(a,b){var c,d=this;return o(a)&&n(b)&&(c=function(){b.call(this,arguments),d.unbind(a,c)},d.bind(a,c)),d},trigger:function(a,b){var c=this,d=!0;return o(a)&&r(c.__listeners[a])&&c.__listeners[a].length>0&&w(c.__listeners[a],function(e){d=e.call(c,b,a)&&d}),d}},b.extend=function e(a){function b(){return!c&&n(this.init)?this.init.apply(this,arguments):void 0}var f,g,h=this.prototype;c=!0,f=new this,c=!1;for(g in a)a.hasOwnProperty(g)&&(n(a[g])&&n(h[g])&&d.test(a[g])?f[g]=function(a,b){return function(){var c,d=this._super;return this._super=h[a],c=b.apply(this,arguments),n(d)?this._super=d:delete this._super,c}}(g,a[g]):f[g]=a[g]);return a.type||(a.type="Object"),b.prototype=f,Object.defineProperty?Object.defineProperty(b.prototype,"constructor",{enumerable:!1,value:b}):b.prototype.constructor=b,b.extend=e,b},b}function l(a,b){function g(a){return a.charAt(0).toLowerCase()+a.slice(1).replace(/_([a-z])/g,function(a,b){return b.toUpperCase()})}function h(a,b,c,d){a.$errors[b]=a.$errors[b]||{},a.$errors[b][c]=d,a[b].$errors[c]=d}function i(a,d){var e,g,i=!0;return d.required===!0&&(a===c||null===a||0===a.length?(h(this,d.methodName,"required",!1),i=!1):h(this,d.methodName,"required",!0)),a!==c&&null!==a&&(f(["st","nu","ob","ar","bo","dt"],d.type)>-1&&(h(this,d.methodName,"type",!0),("st"===d.type&&!o(a)||"nu"===d.type&&!p(a)&&!b.number.test(a)||"ob"===d.type&&!q(a)&&!b.object.test(a)||"ar"===d.type&&!r(a)&&!b.array.test(a)||"bo"===d.type&&!u(a)&&!b["boolean"].test(a)||"dt"===d.type&&!s(new Date(a)))&&(h(this,d.methodName,"type",!0),i=!1)),(p(d.min)||"dt"===d.type&&s(d.min))&&(("st"===d.type||"ar"===d.type)&&a.length>=d.min?h(this,d.methodName,"min",!0):(!d.type||"nu"===d.type)&&parseFloat(a)>=d.min?h(this,d.methodName,"min",!0):"dt"===d.type&&new Date(a)>=new Date(d.min)?h(this,d.methodName,"min",!0):(h(this,d.methodName,"min",!1),i=!1)),(p(d.max)||"dt"===d.type&&s(d.max))&&(("st"===d.type||"ar"===d.type)&&a.length<=d.max?h(this,d.methodName,"max",!0):(!d.type||"nu"===d.type)&&parseFloat(a)<=d.max?h(this,d.methodName,"max",!0):"dt"===d.type&&new Date(a)<=new Date(d.max)?h(this,d.methodName,"max",!0):(h(this,d.methodName,"max",!1),i=!1))),isRegExp(d.matches)&&(e=d.matches.test(a)||t(a)||v(a)||0===a.length,h(this,d.methodName,"matches",e),i=e&&i),r(d.limit)?((t(a)||v(a)||0===a.length)&&h(this,d.methodName,"limit",!1),g=d.limit.indexOf(a)>-1,h(this,d.methodName,"limit",g),i=g&&i):q(d.limit)?((t(a)||v(a)||0===a.length)&&h(this,d.methodName,"limit",!1),g=d.limit.hasOwnProperty(a),h(this,d.methodName,"limit",g),i=g&&i):o(d.limit)&&((t(a)||v(a)||0===a.length)&&h(this,d.methodName,"limit",!1),g=d.limit===a,h(this,d.methodName,"limit",g),i=g&&i),i}var j=function(){};return j=a.extend({$type:"Singleton",init:function(a,b){var d=this._super.apply(this,arguments);return d.__merged=d.__data=a||{},d.__setData={},d.$loaded=a?!0:!1,d.$dirty=!1,d.__fieldConfig=!1,d.each(function(a){function b(){var b,e=a.key;if(a.__getterCacheSet===!0)return a.__getterCache;if(a.getter)b=a.getter.call(d,a);else{for(e=e.split("."),b=d.get()[e.shift()];e.length>0;){if(q(b)===!1)return null;b=b[e.shift()]}null!==b&&b!==c||a["default"]===c||(b=a["default"]),n(a.mutateGet)===!0&&(b=a.mutateGet.call(d,b,a))}return a.__getterCacheSet=!0,a.__getterCache=b,b}function e(b){var c,e,f=a.key;if(a.readonly===!0)throw new Error(a.methodName+" is read-only.");if(d.__merged=!1,d.$dirty=!0,d.$loaded=!0,a.__getterCacheSet=!1,delete a.__getterCache,a.setter)return a.setter.call(d,b,a),d;for(f=f.split("."),e=d.__setData;f.length>1;)c=f.shift(),e=e[c]=q(e[c])===!0?e[c]:{};return n(a.mutateSet)===!0&&(b=a.mutateSet.call(d,b,a)),e[f]=b,d}if(a.getter!==c&&!n(a.getter))throw new Error('Singleton Init Error: "getter" must be undefined/null or a function');if(a.setter!==c&&!n(a.setter))throw new Error('Singleton Init Error: "setter" must be undefined/null or a function');d[a.methodName]=function(c){return arguments.length?e.call(d[a.methodName],c):b.call(d[a.methodName])},d[a.methodName].$errors={},d[a.methodName].$config=a,d[a.methodName].valid=function(b){var c=!0;return 0===arguments.length&&(b=d[a.methodName]()),n(a.validator)&&(c=a.validator.call(d,b,a),h(d,a.methodName,"validator",c)),c=i.call(d,b,a)&&c,d.$valid=c,c}})},get:function(){var a=this;return a.__merged!==!1?a.__merged:(a.__merged=d({},a.__data,a.__setData),a.__merged)},set:function(a){var b=this;return b.__merged=!1,b.$dirty=!0,b.__setData=x(a),b.$loaded=b.$loaded||e(a).length>0,b.clearCache(),b},clearCache:function(){var a=this;return a.__merged!==!1&&(a.__merged=!1,a.each(function(a){a.__getterCacheSet=!1,delete a.__getterCache})),a},each:function(a){var b=this;return q(b.fields)&&b.__fieldConfig===!1&&(b.__fieldConfig=[],w(b.fields,function(a,c){var d=n(a)?a.apply(b,arguments):q(a)?x(a):{};d.key=d.key||c,d.methodName=d.methodName||g(c),b.__fieldConfig.push(d)})),r(b.__fieldConfig)===!0&&b.__fieldConfig.length>0&&w(b.__fieldConfig,function(c){a.call(b,c)}),b},validate:function(){var a=this;return a.each(function(b){a[b.methodName].valid()}),a},cancel:function(){var a=this;return a.$dirty&&(a.$dirty=!1,a.clearCache(),a.__setData={}),a},finalize:function(a){var b=this;return(a||b.$dirty)&&(b.$dirty=!1,b.__data=a||b.get(),b.__setData={},b.trigger("finalize",a)),b},clone:function(){var a=this,b=a._super.apply(a,arguments);return b.__data=x(a.__data),b.set(a.__setData),b.$loaded=a.$loaded,b.$parent=a.$parent,b},resolve:function(){var a=this;return a.$loaded=!0,delete a.$busy,a.clearCache(),a._super.apply(a,arguments)},reject:function(){var a=this;return a.$loaded=!0,delete a.$busy,a.clearCache(),a._super.apply(a,arguments)},refresh:function(){var a=this;return a.__lastReadData?a.read(a.__lastReadData):a.read()},readService:!1,read:function(a){var b,c=this;return n(c.readService)?(c.$busy=!0,c.unfinalize(),c.__lastReadData=a||{},b=c.readService(a,function(a){c.__data=a,c.resolve()},function(a){c.$errors.read=a,c.reject()}),b===!1&&c.reject()):c.reject(),c},updateService:!1,update:function(a){var b,c=this;if(n(c.updateService)){if(c.$busy=!0,c.unfinalize(),0===arguments.length){if(c.$dirty!==!0)return c.resolve();a=c.__setData}b=c.updateService(a,function(a){c.finalize(a),c.resolve()},function(a){c.$errors.update=a,c.reject()}),b===!1&&c.reject()}else c.reject();return c},uploadService:!1,upload:function(a){var b,c=this;return n(c.uploadService)?(c.$busy=!0,c.unfinalize(),b=c.uploadService(a,function(a){c.finalize(a),c.resolve()},function(a){c.$errors.upload=a,c.reject()}),b===!1&&c.reject()):c.reject(),c},createService:!1,create:function(a){var b,c=this;if(n(c.createService)){if(c.$busy=!0,c.unfinalize(),0===arguments.length){if(c.$dirty!==!0)return c.resolve();a=c.get()}b=c.createService(a,function(a){c.finalize(a),c.resolve()},function(a){c.$errors.create=a,c.reject()}),b===!1&&c.reject()}else c.reject();return c},deleteService:!1,"delete":function(a){var b,c=this;return n(c.deleteService)?(c.$busy=!0,c.unfinalize(),b=c.deleteService(a,function(a){c.finalize(a||{}),c.resolve()},function(a){c.$errors["delete"]=a,c.reject()}),b===!1&&c.reject()):c.reject(),c}})}function m(a,b){function d(){var a=this;a.$allSelected=!1,a.$noneSelected=!0,a.$selectedCount===a.length&&a.length>0&&(a.$allSelected=!0),a.$selectedCount>0&&(a.$noneSelected=!1)}function e(a,b){var d,e;if(o(a)&&a.length>0){for(a=a.split(".");a.length>0;)if(e=a.shift(),n(b[e])===!1)d=b[e]();else{if(q(d)===!1)return c;d=b[e]}return d}return c}var f=function(){},i=/^\s+([+-]?)(.*)\s+$/;return f=a.extend({$type:"Collection",childModel:b,init:function(a,b){var c=this._super.apply(this,arguments);c.__data=a||[],c.__addData=[],c.length=c.__data.length,c.$loaded=c.length>0,c.__origData=null,c.$selected=[],c.$selectedCount=0,c.$allSelected=!1,c.$noneSelected=!0},each:function(a,b){var c=this;return n(a)===!0&&w(c.get(),a),c},get:function(){var a=this;return a.__modeled?a.__modeled:(a.__modeled=new Array(a.length),w(a.__data,function(b,c){var e=new a.childModel(b);e.$parent=a,e.select=function(b,e){return this.$selected=b,a.$selected[c]=b,b?a.$selectedCount++:a.$selectedCount--,e!==!0&&d.call(a),this},a.__modeled[c]=e}),a.__modeled)},set:function(a){var b=this.end(!0);return b.__data=a,b.length=b.__data.length,b.$loaded=b.$loaded||b.length>0,b.__modeled=null,b.__filter&&b.filter(b.__filter),b.__sort&&b.sort(b.__sort),b},add:function(a){var c=this,e=[];if(t(a)||null===a)e.push({});else if(a instanceof c.childModel)e.push(a);else if(a instanceof b)e.push(a.get());else if(a instanceof f)e=e.concat(a.get());else if(r(a)===!0)w(a,function(a,b){e.push(b)});else{if(q(a)!==!0)throw new Error("Invalid object added to Collection: "+a);e.push(a)}return w(e,function(a,f){a instanceof c.childModel==!1&&(a instanceof b&&(a=a.get()),a=new c.childModel(a),a.$parent=c,a.select=function(a,b){this.$selected=a,c.$selected[f]=a,a?c.$selectedCount++:c.$selectedCount--,b!==!0&&d.call(c)},e[f]=a)}),c.__addData=e,a instanceof f||r(a)===!0?e:e[0]},filter:function(a){var b=this,c=[];if(b.__data.length>0)if(n(a)===!0)b.__filter=a,b.select(!1),b.__origData=b.__origData||x(b.__data),b.__data=h(b.get(),a),b.length=b.__data.length,b.__modeled=null;else{if(q(a)!==!0)throw new Error("Invalid filter value provided: "+h);keys(a).length>0&&(b.__filter=h,b.select(!1),b.__origData=b.__origData||x(b.__data),h(b.get(),function(a){var b=!0;g(h,function(c,d){var e;return e=n(a[d])===!0?a[d]():a[d],b=b&&_.isEqual(e,c),b===!1?b:void 0}),b===!0&&c.push(a.get())}),b.__data=c,b.length=b.__data.length,b.__modeled=null,d.call(b))}return b},sort:function(a,b){function c(a,c){var d=a;return n(a)===!1&&(a=function(a,f){return a=e(d,a),f=e(d,f),q(a)&&(a=JSON.stringify(a)),q(f)&&(f=JSON.stringify(f)),b!==!0&&(a=(""+a).toLowerCase(),f=(""+f).toLowerCase()),c?a>f?-1:f>a?1:0:a>f?1:f>a?-1:0}),a}function d(a,b){return a=c(a,b),a.next=function(a,b){var e=this;return a=c(a,b),d(function(b,c){return e(b,c)||a(b,c)})},a}var f,g,h=this;if(h.length>0){if(o(a)===!0&&(a=a.split()),n(a)===!0)h.__sort=a,h.__origData=h.__origData||x(h.__data),h.__modeled=h.get().sort(a);else{if(!(r(a)===!0&&a.length>0))throw new Error("Invalid sort value provided: "+a);for(h.__origData=h.__origData||x(h.__data),f=a.reverse().length;f--;){if(a[f]=a[f].exec(i),3!==a[f].length)throw new Error("Invalid sort value provided: "+a[f]);g?g.next(a[f][2],"-"===a[f][1]?!0:!1):g=d(a[f][2],"-"===a[f][1]?!0:!1)}h.__modeled=h.get().sort(g)}h.__data=new Array(h.length),h.each(function(a,b){h.__data[b]=a.get()})}return h},end:function(a){var b=this;return null!==b.__origData&&(b.select(!1),b.__data=x(b.__origData),b.__addData=[],b.__modeled=null,b.length=b.__data.length,b.__origData=null,a!==!0&&(delete b.__sort,delete b.__filter)),b},unique:function(a){var b=this,d={},f=[];return o(a)&&a.length>0&&b.each(function(b,g){var h=e(a,g);r(h)===!0?w(h,function(a){q(a)===!0&&(a=JSON.stringify(a)),d[a.toString()]===c&&(d[a.toString()]=!0,f.push(a))}):(q(h)===!0&&(h=JSON.stringify(h)),d[h.toString()]===c&&(d[h.toString()]=!0,f.push(h)))}),f},select:function(a,b){var c=this;return a===!0?(c.$selected=new Array(c.length),c.$selectedCount=0,c.each(function(){this.select(!0,!0)})):a===!1?(c.each(function(){this.select(!1,!0)}),c.$selected=[],c.$selectedCount=0):p(a)===!0&&c.get()[a].select(b),d.call(c),c},clone:function(){var a=this,b=a._super.apply(a,arguments);return b.__data=x(a.__data),b.__addData=x(a.__addData),b.__origData=x(a.__origData),b.length=a.length,b.$loaded=b.$loaded,b.$selected=a.$selected,b.$selectedCount=a.$selectedCount,b.$allSelected=a.$allSelected,b.$noneSelected=a.$noneSelected,b},resolve:function(){var a=this;return a.$loaded=!0,delete a.$busy,a._super.apply(a,arguments)},reject:function(){var a=this;return a.$loaded=!0,delete a.$busy,a._super.apply(a,arguments)},refresh:function(){var a=this;return a.__lastReadData?a.read(a.__lastReadData):a.read()},readService:!1,read:function(a){var b,c=this;return n(c.readService)&&(c.$busy=!0,c.unfinalize(),c.__lastReadData=a||{},b=c.readService(a,function(a){c.set(a),c.resolve()},function(a){c.$errors.read=a,c.reject()}),b===!1&&c.reject()),c},updateService:!1,update:function(a){var b,c=this;if(n(c.updateService)){if(c.$busy=!0,c.unfinalize(),0===arguments.length)return c.resolve();b=c.updateService(a,function(a){c.finalize(a),c.resolve()},function(a){c.$errors.update=a,c.reject()}),b===!1&&c.reject()}else c.reject();return c}})}var n=(b.isDefined,b.isFunction),o=b.isString,p=b.isNumber,q=b.isObject,r=b.isArray,s=b.isDate,t=b.isUndefined,u=function(a){return a===!0||a===!1?!0:!1},v=function(a){return null===a},w=b.forEach,x=(b.extend,b.copy);b.module("angular-m",[]),i.$inject=["$rootScope","$http"],b.module("angular-m").service("m-http",i),j.$inject=[],b.module("angular-m").constant("REGEX",j),k.$inject=[],b.module("angular-m").factory("Base",k),l.$inject=["Base","REGEX"],b.module("angular-m").factory("Singleton",l),m.$inject=["Base","Singleton"],b.module("angular-m").factory("Collection",m)}(window,window.angular);